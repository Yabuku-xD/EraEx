<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EraEx - Nostalgia Machine</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@300;400;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="overlay"></div>
    <div class="container">
        <header>
            <h1>EraEx <span class="year-badge">2012-2018</span></h1>
            <p>Relive the golden era of streaming.</p>
        </header>

        <main>
            <div class="search-box">
                <input type="text" id="query">
                <button onclick="searchMusic()">Travel Back</button>
            </div>

            <div id="results" class="results-grid">
                <!-- Results will appear here -->
            </div>

            <div id="loading" class="hidden">
                <div class="spinner"></div> Searching the archives...
            </div>
        </main>
    </div>

    <script>
        async function searchMusic() {
            const query = document.getElementById('query').value;
            async function performSearch() {
                const query = document.getElementById('searchInput').value;
                const isSonic = document.getElementById('sonicMode').checked;
                const resultsDiv = document.getElementById('results');

                if (!query) return;

                resultsDiv.innerHTML = '<div class="track-card">Loading...</div>';

                try {
                    let url;
                    if (isSonic) {
                        // SONIC SEARCH
                        url = `/sonic?q=${encodeURIComponent(query)}&limit=9`;
                    } else {
                        // STANDARD (Nostalgia) SEARCH
                        url = `/search?q=${encodeURIComponent(query)}`;
                    }

                    const response = await fetch(url);
                    const data = await response.json();

                    resultsDiv.innerHTML = '';

                    if (data.results && data.results.length > 0) {
                        data.results.forEach(track => {
                            const card = document.createElement('div');
                            card.className = 'track-card';

                            // Handle slight schema diff between endpoints
                            const title = track.title_short || track.title;
                            const artist = track.artist.name || track.artist;
                            const cover = track.album ? track.album.cover_medium : 'https://e-cdns-images.dzcdn.net/images/cover/d41d8cd98f00b204e9800998ecf8427e/250x250-000000-80-0-0.jpg';

                            // Add "Sonic Score" badge if applicable
                            let scoreBadge = '';
                            if (track.score && isSonic) {
                                const pct = Math.round(track.score * 100);
                                scoreBadge = `<div style="font-size: 0.8em; color: #ff00ff; margin-bottom: 5px;">Match: ${pct}%</div>`;
                            }
                            loadingDiv.classList.add('hidden');
                            resultsDiv.innerHTML = `<p class="error">Something went wrong. The time machine is jammed.</p>`;
                        }
        }

                    document.getElementById('query').addEventListener('keypress', function (e) {
                        if (e.key === 'Enter') searchMusic();
                    });
    </script>
</body>

</html>